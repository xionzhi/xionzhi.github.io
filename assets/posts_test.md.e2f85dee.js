import{_ as s,o as a,c as n,a as l}from"./app.06916134.js";const A=JSON.parse('{"title":"test","description":"","frontmatter":{"title":"test","author":"xionzhi","date":"2022-12-20","showAccessNumber":true,"categories":["测试"],"tags":["标签1","标签2","标签3"],"excerpt":""},"headers":[{"level":3,"title":"小标题1-表单","slug":"小标题1-表单","link":"#小标题1-表单","children":[]},{"level":3,"title":"小标题2-Emoji","slug":"小标题2-emoji","link":"#小标题2-emoji","children":[]},{"level":3,"title":"小标题3-Containers","slug":"小标题3-containers","link":"#小标题3-containers","children":[]},{"level":3,"title":"小标题4-Containers","slug":"小标题4-containers","link":"#小标题4-containers","children":[]},{"level":3,"title":"小标题5","slug":"小标题5","link":"#小标题5","children":[]},{"level":3,"title":"小标题6","slug":"小标题6","link":"#小标题6","children":[]},{"level":3,"title":"小标题7","slug":"小标题7","link":"#小标题7","children":[]},{"level":3,"title":"bitmap指令说明","slug":"bitmap指令说明","link":"#bitmap指令说明","children":[]}],"relativePath":"posts/test.md"}'),p={name:"posts/test.md"},o=l(`<nav class="table-of-contents"><ul><li><a href="#小标题1-表单">小标题1-表单</a></li><li><a href="#小标题2-emoji">小标题2-Emoji</a></li><li><a href="#小标题3-containers">小标题3-Containers</a></li><li><a href="#小标题4-containers">小标题4-Containers</a></li><li><a href="#小标题5">小标题5</a></li><li><a href="#小标题6">小标题6</a></li><li><a href="#小标题7">小标题7</a></li><li><a href="#bitmap指令说明">bitmap指令说明</a></li></ul></nav><p><a href="https://vitepress.vuejs.org/guide/markdown" target="_blank" rel="noreferrer">vitepress.vuejs.org/guide/markdown</a></p><h3 id="小标题1-表单" tabindex="-1">小标题1-表单 <a class="header-anchor" href="#小标题1-表单" aria-hidden="true">#</a></h3><table><thead><tr><th>Tables</th><th style="text-align:center;">Are</th><th style="text-align:right;">Cool</th></tr></thead><tbody><tr><td>col 3 is</td><td style="text-align:center;">right-aligned</td><td style="text-align:right;">$1600</td></tr><tr><td>col 2 is</td><td style="text-align:center;">centered</td><td style="text-align:right;">$12</td></tr><tr><td>zebra stripes</td><td style="text-align:center;">are neat</td><td style="text-align:right;">$1</td></tr></tbody></table><h3 id="小标题2-emoji" tabindex="-1">小标题2-Emoji <a class="header-anchor" href="#小标题2-emoji" aria-hidden="true">#</a></h3><p>🎉 💯</p><p><a href="https://github.com/markdown-it/markdown-it-emoji/blob/master/lib/data/full.json" target="_blank" rel="noreferrer">list of all emojis</a></p><h3 id="小标题3-containers" tabindex="-1">小标题3-Containers <a class="header-anchor" href="#小标题3-containers" aria-hidden="true">#</a></h3><div class="info custom-block"><p class="custom-block-title">INFO</p><p>This is an info box.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This is a tip.</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This is a warning.</p></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>This is a dangerous warning.</p></div><details class="details custom-block"><summary>Details</summary><p>This is a details block.</p></details><div class="danger custom-block"><p class="custom-block-title">STOP</p><p>Danger zone, do not proceed</p></div><h3 id="小标题4-containers" tabindex="-1">小标题4-Containers <a class="header-anchor" href="#小标题4-containers" aria-hidden="true">#</a></h3><h3 id="小标题5" tabindex="-1">小标题5 <a class="header-anchor" href="#小标题5" aria-hidden="true">#</a></h3><h3 id="小标题6" tabindex="-1">小标题6 <a class="header-anchor" href="#小标题6" aria-hidden="true">#</a></h3><h3 id="小标题7" tabindex="-1">小标题7 <a class="header-anchor" href="#小标题7" aria-hidden="true">#</a></h3><p>Redis提供的数据类型位图BitMap，每个bit位对应0和1两个状态。虽然内部还是采用String类型存储，但Redis提供了一些指令用于直接操作BitMap，可以把它看作一个bit数组，数组的下标就是偏移量。</p><p>它的优点是内存开销小，效率高且操作简单，很适合用于签到这类场景。缺点在于位计算和位表示数值的局限。如果要用位来做业务数据记录，就不要在意value的值。</p><h3 id="bitmap指令说明" tabindex="-1">bitmap指令说明 <a class="header-anchor" href="#bitmap指令说明" aria-hidden="true">#</a></h3><ol><li><p>BITCOUNT</p><p>计算给定字符串中，被设置为 1 的比特位的数量</p></li><li><p>BITFIELD</p><p>在一次调用中同时对多个位范围进行操作</p></li><li><p>BITFIELD_RO</p><p>BITFIELD的只读版本，redis&gt;=6.0</p></li><li><p>BITOP</p><p>对一个或多个保存二进制位的字符串 key 进行位元操作</p></li><li><p>BITPOS</p><p>返回位图中第一个值为 bit 的二进制位的位置</p></li><li><p>GETBIT</p><p>对 key 所储存的字符串值，获取指定偏移量上的位(bit)</p></li><li><p>SETBIT</p><p>对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)</p></li></ol><p>原地右移之后最后一位则是前一天的签到状态</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> typing </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> t</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> calendar </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> monthrange</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> datetime </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> datetime</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> timedelta</span></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> operator </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> rshift</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> lshift</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> irshift</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> redis </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> Redis</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">UserSign</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">=None,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">port</span><span style="color:#89DDFF;">=None,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">=None,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">decode_responses</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">        now: 2022-10-20</span></span>
<span class="line"><span style="color:#676E95;">        bitmap.len: 0 * 20</span></span>
<span class="line"><span style="color:#676E95;">        set 2-4 14-20</span></span>
<span class="line"><span style="color:#676E95;">        bitmap.info: 01111000000001111111 -&gt; int10(491647)</span></span>
<span class="line"><span style="color:#676E95;">        </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">host</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> host </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">port</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> port </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6379</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">db</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> db </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">decode_responses</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> decode_responses </span><span style="color:#89DDFF;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">redis_store</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Redis</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">host</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                 </span><span style="color:#A6ACCD;">port</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                 </span><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">db</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                 </span><span style="color:#A6ACCD;">decode_responses</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">decode_responses</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#FFCB6B;">staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">_build_sign_key</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">uid</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> datetime</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;u:sign:</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">uid</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strftime</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%Y%m</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">do_sign</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">uid</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">date</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> datetime</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">        用户签到</span></span>
<span class="line"><span style="color:#676E95;">        :return 之前的签到状态</span></span>
<span class="line"><span style="color:#676E95;">        </span><span style="color:#89DDFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        offset</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> date</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">day</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">redis_store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setbit</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">_build_sign_key</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">uid</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> date</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> offset</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    us </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">UserSign</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    _uid </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">    _date </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> datetime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,24),e=[o];function t(r,c,D,i,y,F){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
